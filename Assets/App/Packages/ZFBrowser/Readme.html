<html>
<head>
	<meta charset="UTF-8">
	<title>ZFBrowser Documentation</title>
	<link rel="icon" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAABL1BMVEUAAAAAAAAAAAAAAAAAAAAQAAABBBwZAAAAFAUUAAAADwMAAAAAAAAAAAAAAAAAAAAAAAAABgIuAAAsAAAANQwAGAUAAg0AAAAAAAAAAAAAAAAAAAAAwzIAvzAEOvwEPP8ESP0EQ/0EP/0ABQvtAAADMfgAHpkA1DkAzjcAyzYAyDUAuC0AaBj4AADyAADpAADmAADjAADWAADLAABAAAAFS/8DNP8FTf4DNvwEOPYDK/ICIroCEF0A0DkAvC8AnyYAnCUAkCIAdxwAAhgAQQ8bBAECBAB4AQD7AADwAADfAADcAAC5AAC0AACIAABOAAADMf8DJcwCIbACHaMCGYsBD0EBDTYAlSEAjSEASREASBEAAw8TAgwAMQsCJQkALwgAQAT0AADhAABjAABeAABD9A36AAAAHHRSTlMAGK5/eP7B1syvpoloYFUTAfnr6ujkvaaUb10gmPaQKAAAAOZJREFUGNM1j9dWwlAQRSeFSBGw13tBTQA1HSLSpPdmV3r//29gILDfzj7rrDUDGxif2+l0+xjYcgT8WbGQyxWUc942l9XqpCfLWUrLHkA4q9NsWwqlhJCyF/cnpqrWpUqekOen7DEDN11N0+b1WhHzY2TAg6stSY2GWlMwv0X6LBzEdF2XjMqYYqbiBQrTMGJWqTTLy//TbwFcneYiOkonk+k/8fczxYK32zLfwy939w/BePzjhwfmtBV1BF9RBBKJlOjHw5Z7EQhlDgG5Wu0moYzH/u7aIX5hHR5ib3PLsYLAcn5A1tqnJNnWRf14AAAAAElFTkSuQmCC">
	<style type="text/css">
		body {
			font-family: sans-serif;
			margin: 0;
			padding: 0;
		}

		* { box-sizing: border-box; }

		#title {
			position: absolute;
			top: 0; left: 0; right: 0; height: 40px;
			border-bottom: 1px solid black;
			font-size: 28px;
			padding: 4px;
		}

		#toc {
			position: absolute;
			top: 40px; left: 0; bottom: 0; width: 200px;
			overflow: auto;
			padding: 4px;
		}

		#toc ul {
			padding: 0px 15px;
			font-size: 80%;
			margin: 5px;
		}
		#toc .sidebar-header-2 {
			margin-left: 10px;
			list-style-type: circle;
		}
		#toc .sidebar-header-3 {
			margin-left: 20px;
			list-style-type: circle;
		}

		#content {
			position: absolute;
			top: 40px; right: 0; bottom: 0; left: 200px;
			overflow: auto;
			border-left: 1px solid black;
			padding: 0px 18px;
		}

		code {
			background: #EEE;
			border: 1px solid #CCC;
			padding: 0 2px;
			margin: 0 2px;
		}

		pre code {
			display: block;
			margin: 2px;
		}

		h1 {
			font-size: 1.5em;
			border-bottom: 1px solid gray;
		}

		h2 { font-size: 1.2em; }
		h3 { font-size: 1.0em; }

	</style>

</head>
<body>

<div id="title">ZFBrowser Documentation</div>

<div id="toc"><ul class="nav nav-list">
    <li class="sidebar-header-1"><a href="#zfbrowser-documentation">ZFBrowser Documentation</a></li>
    <li class="sidebar-header-1"><a href="#quick-start">Quick Start</a></li>
    <li class="sidebar-header-1"><a href="#general">General</a></li>
    <li class="sidebar-header-2"><a href="#important-note">Important Note</a></li>
    <li class="sidebar-header-2"><a href="#supported-platforms">Supported Platforms</a></li>
    <li class="sidebar-header-2"><a href="#os-x-users">OS X Users</a></li>
    <li class="sidebar-header-2"><a href="#linux-users">Linux Users</a></li>
    <li class="sidebar-header-2"><a href="#other-platforms">Other Platforms</a></li>
    <li class="sidebar-header-1"><a href="#scripting">Scripting</a></li>
    <li class="sidebar-header-2"><a href="#javascript-vs-unityscript">JavaScript vs UnityScript</a></li>
    <li class="sidebar-header-2"><a href="#scripting-intro">Scripting Intro</a></li>
    <li class="sidebar-header-2"><a href="#notes">Notes</a></li>
    <li class="sidebar-header-2"><a href="#promises">Promises</a></li>
    <li class="sidebar-header-1"><a href="#embedded-resources">Embedded Resources</a></li>
    <li class="sidebar-header-2"><a href="#notes-1">Notes</a></li>
    <li class="sidebar-header-1"><a href="#input">Input</a></li>
    <li class="sidebar-header-2"><a href="#vr-input">VR Input</a></li>
    <li class="sidebar-header-3"><a href="#steamvr">SteamVR</a></li>
    <li class="sidebar-header-3"><a href="#oculus-vr">Oculus VR</a></li>
    <li class="sidebar-header-3"><a href="#common">Common</a></li>
    <li class="sidebar-header-2"><a href="#external-keyboard">External Keyboard</a></li>
    <li class="sidebar-header-1"><a href="#customization">Customization</a></li>
    <li class="sidebar-header-1"><a href="#debugging">Debugging</a></li>
    <li class="sidebar-header-2"><a href="#page-debugging">Page Debugging</a></li>
    <li class="sidebar-header-3"><a href="#page-inspector">Page Inspector</a></li>
    <li class="sidebar-header-3"><a href="#external-page-inspector">External Page Inspector</a></li>
    <li class="sidebar-header-3"><a href="#ordinary-browser">Ordinary Browser</a></li>
    <li class="sidebar-header-1"><a href="#cookies">Cookies</a></li>
    <li class="sidebar-header-1"><a href="#notes-2">Notes</a></li>
    <li class="sidebar-header-2"><a href="#latency/performance">Latency/Performance</a></li>
    <li class="sidebar-header-2"><a href="#architecture">Architecture</a></li>
    <li class="sidebar-header-1"><a href="#adobe-flash">Adobe Flash</a></li>
    <li class="sidebar-header-2"><a href="#do-i-need-it?">Do I need it?</a></li>
    <li class="sidebar-header-2"><a href="#for-myself-(manual-install)">For myself (manual install)</a></li>
    <li class="sidebar-header-2"><a href="#for-anyone-(distribute-flash)">For anyone (distribute Flash)</a></li>
    <li class="sidebar-header-1"><a href="#get-help">Get Help</a></li>
</ul>

</div>

<div id="content"><h1 id="zfbrowser-documentation"><a class="header-link" href="#zfbrowser-documentation"></a>ZFBrowser Documentation</h1>
<p>This asset allows you to embed a full copy of Chromium, the open-source core of Google Chrome, inside your game!</p>
<p><a href="http://zenfulcrum.com/browser">Product Page</a> | <a href="https://www.assetstore.unity3d.com/#!/content/55459">Unity Asset Store</a> | <a href="Changelog.txt">Changelog</a> | <a href="#get-help">Get Help</a></p>
<p>Documentation for ZFBrowser v3.1.0.</p>
<p><small>Uses CEF 74.1.19+gb62bacf+chromium-74.0.3729.157 / Chromium 74.0.3729.157.</small></p>
<p><small>Copyright &copy; 2015-2019 Zen Fulcrum LLC</small></p>
<h1 id="quick-start"><a class="header-link" href="#quick-start"></a>Quick Start</h1>
<p>Basic Browser:</p>
<ul class="list">
<li>If you are using <a href="#linux-users">Linux</a> or <a href="#os-x-users">OS X</a> read the platform-specific notes.</li>
<li>Import ZFBrowser into your project.</li>
<li>Grab <code>ZFBrowser/Prefabs/Browser (Mouse)</code> and drop it into your scene.</li>
<li>On this new object, set the URL to a site of your choice, such as <code>https://google.com/</code></li>
<li>Fiddle with your camera so the quad fills most of the view.</li>
<li>Hit play and interact with the web site.</li>
</ul>
<p>Embedded assets:</p>
<ul class="list">
<li>Start with the scene above.</li>
<li>Create a folder called <code>BrowserAssets</code> right next to (not inside!) your <code>Assets</code> folder.</li>
<li>Create a file called <code>index.html</code> inside <code>BrowserAssets</code> and put this in it: <code>&lt;h1&gt;Hello World!&lt;/h1&gt;</code></li>
<li>Set the URL for your browser to <code>localGame://index.html</code></li>
<li>Hit play.</li>
</ul>
<p>Congratulations! You now have a browser in your game!</p>
<p>See <a href="#vr-input">this section</a> if you want to use the browser in VR.</p>
<h1 id="general"><a class="header-link" href="#general"></a>General</h1>
<h2 id="important-note"><a class="header-link" href="#important-note"></a>Important Note</h2>
<p>This library is made possible by a number of third-party open source software projects!</p>
<p>A copy of <a href="ThirdPartyNotices.txt">ThirdPartyNotices.txt</a> needs to be distributed with your product. The build scripts copy it automatically.</p>
<h2 id="supported-platforms"><a class="header-link" href="#supported-platforms"></a>Supported Platforms</h2>
<p>This plugin is available for the given platforms and architectures:</p>
<ul class="list">
<li>Windows Standalone, 32-bit (Mono) and 64-bit (Mono or il2cpp)<ul class="list">
<li><small><em>Does not</em> include WSA/UWP/HoloLens support.</small></li>
<li><small>May not work if basic updates have not been installed. Windows XP is not supported.</small></li>
</ul>
</li>
<li>Linux Standalone, 64-bit (experimental) (Mono)<ul class="list">
<li><small>The most recent Ubuntu LTS should work. Let me know if you find a mainstream, recent distro that has issues.</small></li>
<li><small>Unity 2018.3.0, and probably certain other 2018.3.x versions, do not work. Try Unity 2018.3.8+.</small></li>
</ul>
</li>
<li>OS X Standalone, 64-bit (Mono or il2cpp)<ul class="list">
<li><small><em>Does not</em> include Mac App Store support</small></li>
</ul>
</li>
</ul>
<p>Except as noted, only building on the same platform as your target is supported. If you have troubles making a build or testing in the editor, try again with the Unity Editor running on your target platform.</p>
<p>This Asset does not include licenses for <a href="http://ossguy.com/?p=233">proprietary or patent-encumbered codecs</a> such as h.264. (Most streaming sites use patent-encumbered codecs and will not work. YouTube videos generally work, unless they are live.) Consider re-encoding your content with an open codec supported by stock Chromium such as WebM or Ogg Vorbis.</p>
<h2 id="os-x-users"><a class="header-link" href="#os-x-users"></a>OS X Users</h2>
<ul class="list">
<li>(Pre-Unity 2017.3) By default, your new Unity project will target universal builds, you&#39;ll need to change it to x64 before you can build and run your application.</li>
<li>You can make OS X builds from Windows, but make sure that correct files are marked executable once they reach an OS X filesystem: <code>chmod +x MyGame.app/Contents/MacOS/MyGame MyGame.app/Contents/Frameworks/ZFGameBrowser.app/Contents/MacOS/ZFGameBrowser</code></li>
</ul>
<h2 id="linux-users"><a class="header-link" href="#linux-users"></a>Linux Users</h2>
<ul class="list">
<li>Linux support is experimental.</li>
<li>You can make Linux builds from Windows, but make sure that correct files are marked executable once they reach a Linux filesystem: <code>chmod +x MyGame.x86_64 MyGame_Data/Plugins/ZFGameBrowser</code></li>
<li>Newer versions of Ubuntu: You need to <code>sudo apt install libgconf2-4</code> as an installation dependency.</li>
</ul>
<h2 id="other-platforms"><a class="header-link" href="#other-platforms"></a>Other Platforms</h2>
<p>ZFBrowser is only supported on the platforms listed above right now. If you&#39;re interested in support for other platforms, <a href="https://docs.google.com/forms/d/e/1FAIpQLSdYckZsTlN7iDsPRG5Z1BPhsat5DkyrR0wr9Nru1L_HJcUBtQ/viewform">please let me know</a>! In most cases I can&#39;t simply port the existing backend to another OS, but having your votes will help me know what is most worthwhile to work on!</p>
<h1 id="scripting"><a class="header-link" href="#scripting"></a>Scripting</h1>
<p>You can send and receive messages from the currently loaded browser page.</p>
<h2 id="javascript-vs-unityscript"><a class="header-link" href="#javascript-vs-unityscript"></a>JavaScript vs UnityScript</h2>
<p>Browsers run JavaScript, specifically, ECMAScript. JavaScript has a .js extension.
Unity runs .NET languages, in particular: C# (.cs) and previously Boo (.boo) and UnityScript (.js). Due to a terrible historical mistake, UnityScript has been, and often still is, called &quot;JavaScript&quot;. To be clear:</p>
<blockquote>
<p><strong>UnityScript IS NOT JavaScript.</strong></p>
</blockquote>
<p>In this package all references to &quot;JavaScript&quot; refer to what web browsers run.
Beware that UnityScript and JavaScript files both have the same .js extension. In general, files in Assets/ with a .js extension will be treated as UnityScript and files in BrowserAssets/ with a .js extension will be treated as JavaScript.</p>
<h2 id="scripting-intro"><a class="header-link" href="#scripting-intro"></a>Scripting Intro</h2>
<p>Browsers have a <code>Browser</code> MonoBehaviour. You can call functions in the page by invoking <code>CallFunction</code>:</p>
<pre class="hljs"><code><span class="hljs-keyword">using</span> ZenFulcrum.EmbeddedBrowser;
...
<span class="hljs-keyword">var</span> browser = GetComponent&lt;Browser&gt;();<span class="hljs-comment">//assuming we are a MonoBehaviour attached to the same GameObject as the Browser</span>

<span class="hljs-comment">//calls window.setPlayerStats("myPlayerName", 2, 4200, false) in the browser</span>
browser.CallFunction(<span class="hljs-string">"setPlayerStats"</span>, <span class="hljs-string">"myPlayerName"</span>, <span class="hljs-number">2</span>, <span class="hljs-number">4200</span>, <span class="hljs-literal">false</span>).Done();</code></pre><p>Functions are resolved in the global scope of the top frame of the browser and executed with the given arguments. You can pass basic types (strings, integers, bools, etc.) without any extra effort.</p>
<p>You can also use <code>EvalJS</code> to run any JavaScript you&#39;d like in the context of the page:</p>
<pre class="hljs"><code><span class="hljs-selector-tag">browser</span><span class="hljs-selector-class">.EvalJS</span>(<span class="hljs-string">"if (someCondition()) someVar = 42;"</span>)<span class="hljs-selector-class">.Done</span>();</code></pre><p>To query the page for data, you can look at the return value. <code>EvalJS</code> and <code>CallFunction</code> don&#39;t execute immediately, they are asynchronous, therefore they return promises:</p>
<pre class="hljs"><code><span class="hljs-selector-tag">browser</span><span class="hljs-selector-class">.EvalJS</span>(<span class="hljs-string">"document.title"</span>)<span class="hljs-selector-class">.Then</span>(ret =&gt; Debug.Log(<span class="hljs-string">"Document title: "</span> + ret))<span class="hljs-selector-class">.Done</span>();
<span class="hljs-selector-tag">browser</span><span class="hljs-selector-class">.CallFunction</span>(<span class="hljs-string">"doSomeFoo"</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>)<span class="hljs-selector-class">.Then</span>(ret =&gt; Debug.Log(<span class="hljs-string">"Result: "</span> + ret))<span class="hljs-selector-class">.Done</span>();</code></pre><p>If you are in a Unity coroutine, you can wait for the promises to finish before continuing:</p>
<pre class="hljs"><code><span class="hljs-built_in">var</span> promise = browser.EvalJS(<span class="hljs-string">"document.title"</span>);
<span class="hljs-keyword">yield</span> <span class="hljs-keyword">return</span> promise.ToWaitFor();
Debug.<span class="hljs-keyword">Log</span>(<span class="hljs-string">"Document title: "</span> + promise.Value);</code></pre><p>This can be much easier to deal with in cases where you are chaining a lot of tasks.</p>
<p>You&#39;ll typically want to add <code>.Done()</code> after any <code>EvalJS()</code> or <code>CallFunction()</code> calls. This will add a default error handler that will log any unhandled exceptions or syntax errors in your code. <strong>You won&#39;t get errors for your evaluated code unless you call <code>EvalJS(...).Done()</code></strong> or otherwise use the Promise API to handle the error. If you don&#39;t call <code>.Done()</code>, <code>.Catch()</code>, or the like your code will still execute, you just won&#39;t be notified if it fails.</p>
<p>See <a href="#promises">the promise section</a> for more details on the promise library.</p>
<p>To receive events pushed from the page, you can expose a function callback. Do this with <code>RegisterFunction</code>:</p>
<pre class="hljs"><code>browser.RegisterFunction(<span class="hljs-string">"confirmClicked"</span>, <span class="hljs-keyword">args</span> =&gt; Debug.<span class="hljs-built_in">Log</span>(<span class="hljs-string">"Button clicked: "</span> + <span class="hljs-keyword">args</span>[0] + <span class="hljs-string">" val: "</span> + (int)<span class="hljs-keyword">args</span>[1]));</code></pre><p>Then you can call it from your page:</p>
<pre class="hljs"><code><span class="hljs-comment">&lt;!-- When this is clicked, Unity will log "Button clicked: button3 val: 13" --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">"confirmClicked('button3', 13)"</span>&gt;</span>Confirm Things<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></code></pre><h2 id="notes"><a class="header-link" href="#notes"></a>Notes</h2>
<ul class="list">
<li>The functions that return data from a page return a <code>JSONNode</code>. This is a class which implicitly converts to basic types like strings and integers. Take a look in JSONNode.cs for more information.</li>
<li>If you&#39;d like to pass something more complex than a basic type, build a <code>JSONNode</code>. A <code>JSONNode</code> allows you to build and access JSON data using a fairly fluent language-native interface.</li>
<li>If you&#39;d like to pass something yet still more complex, or have data automatically read from your objects&#39; fields:<ul class="list">
<li>You can use any JSON system (such as <a href="http://docs.unity3d.com/Manual/JSONSerialization.html">Unity&#39;s functions</a>, Json.NET/Newtonsoft.Json, or another library of your choice) to pack and unpack data on the Unity side.</li>
<li>You can use <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/JSON">JSON.stringify/parse</a> on the JavaScript/browser side.</li>
</ul>
</li>
<li>You can also evaluate raw JavaScript in the browser by calling browser.EvalJS</li>
<li>If the Browser isn&#39;t ready for commands or the page isn&#39;t loaded yet, it will queue your commands and execute them then the page is loaded.</li>
<li>The JavaScript execution engine is V8. Not only is JavaScript support robust and complete, you can also use <a href="http://es6-features.org/">es6 features</a> supported by the backing Chromium version.</li>
<li>Note that functions you expose won&#39;t be available at the time of the HTML load event. If you need to know when the page loads, use browser.WhenLoaded (Unity side).</li>
<li>Check out the included demo and examples for some example code and use cases.</li>
<li>For pages that have Content Security Policies preventing use of eval (&quot;Refused to execute inline script because it violates the following Content Security Policy ...&quot;), use <code>EvalJSCSP</code>.  There&#39;s pitfalls, so read the function&#39;s documentation.</li>
</ul>
<h2 id="promises"><a class="header-link" href="#promises"></a>Promises</h2>
<p>ZFBrowser uses <a href="https://github.com/Real-Serious-Games/C-Sharp-Promise">this promise library</a> made by Real Serious Games with some small changes.</p>
<p>Original documentation can be <a href="Promises.html">found here</a> or <a href="https://github.com/Real-Serious-Games/C-Sharp-Promise/blob/master/README.md">online here</a>.</p>
<p>This copy has been modified a bit from the version you can get from GitHub, namely:</p>
<ul class="list">
<li>The library namespace has been changed from <code>RSG</code> to <code>ZenFulcrum.EmbeddedBrowser</code> namespace for simplicity and to avoid potential conflicts.</li>
<li>An <code>UnhandledException</code> handler for <code>Debug.LogError</code> is registered by default.</li>
<li>You can use Promises with coroutines: <code>yield return somePromise.ToWaitFor();</code> waits for the promise to be rejected or resolved.</li>
<li>You can query a Promise for its resolved value (or rejection) with <code>promise.Value</code>.</li>
</ul>
<p>The promise library is covered by the MIT license, as noted in ThirdPartyNoticies.txt.</p>
<h1 id="embedded-resources"><a class="header-link" href="#embedded-resources"></a>Embedded Resources</h1>
<p>You can embed web resources (HTML, JS, CSS, images, etc.) with your game and access them without the need for an external web server.</p>
<p>Place these resources in a folder named <code>BrowserAssets</code> next to your <code>Assets</code> folder, then access them with <code>localGame://index.html</code> instead of the usual <code>http://example.com/index.html</code>.</p>
<h2 id="notes-1"><a class="header-link" href="#notes-1"></a>Notes</h2>
<ul class="list">
<li><code>localGame://</code> is treated like a unique domain and is subject to same-domain policies like other websites.<ul class="list">
<li>Remember: If you want to run scripts on arbitrary websites, you can open a browser to that website and inject JavaScript with browser.EvalJS.</li>
</ul>
</li>
<li>If you want to customize or change how these resources are fetched, read the documentation in WebResources.cs.</li>
<li>In the editor, you can simply refresh a page to see updated changes for changed files.</li>
<li><strong>File names are case-sensitive!</strong> Test your standalone build. Under the Editor some platforms may incorrectly load wRonGcapS successfully.</li>
<li>When you build, all browser assets are packaged up as a single file and included with the build.</li>
<li><code>localGame://</code> is not the actual URL the browser uses, so don&#39;t hardcode it in your HTML. (The real URL is currently <code>https://game.local/</code>, but may change.)</li>
<li>Avoid putting untrusted code in BrowserAssets</li>
<li>You may need to URL-encode your path if it contains non-alphanumeric characters. <a href="https://en.wikipedia.org/wiki/Percent-encoding">How to encode</a></li>
</ul>
<h1 id="input"><a class="header-link" href="#input"></a>Input</h1>
<p>All mouse/keyboard input events are collected in Unity and forwarded to the underlying browser. How this input is sent can be customized.</p>
<ul class="list">
<li>Out of the box, there are systems included for taking input from mouse, screen touches, camera ray (FPS), and tracked VR controllers. These input systems support browsers that are rendered either a) to a mesh (of any shape) with an appropriate mesh collider or b) Unity&#39;s GUI system.</li>
<li>A few browser prefabs are included. Which one you use depends on what type of input you&#39;d like:<ul class="list">
<li>Have a mesh in a scene you click on with your regular mouse cursor? Use the <code>Browser (Mouse)</code> prefab. It uses a <code>PointerUIMesh</code> that listens for mouse events and touch events and a <code>CursorRendererOS</code> to change the ordinary mouse cursor to match the page.</li>
<li>Have a character walking around in a scene that interacts with browser &quot;screens&quot;? Use the <code>Browser (FPS)</code> prefab along with your character controller to use a camera&#39;s forward ray to point and the mouse to click. It calculates rays from the main (or your given) camera and uses a <code>CursorRendererOverlay</code> to render the cursor in the middle of the game view.</li>
<li>Have a GUI of some sort? Take a <code>Browser (GUI)</code> and drop it into a <code>Canvas</code> object. (It uses a <code>CursorRendererOS</code> to change the mouse cursor.)<ul class="list">
<li>Consider setting the <code>Canvas</code>&#39;s <code>Pixel Perfect</code> flag to true for a nicer-looking screen-space browser.</li>
<li>Note that the browser BG being transparent/opaque may affect font subpixel hinting.</li>
</ul>
</li>
<li>Want to point at the browser in VR with tracked controllers? Use the <code>Browser (VR)</code> prefab. VR needs some extra setup, <a href="#vr-input">keep reading here</a>. (It uses a <code>CursorRendererWorldSpace</code> to render the cursor in the game world.)</li>
</ul>
</li>
<li>All input handlers above (except the GUI one) use a mesh collider and rays to determine where on the browser you are pointing. You can customize the shape of the mesh, but make sure the collider a) has the same mesh or b) a substantially similar mesh with UVs that visually align.</li>
<li>A wide variety of mouse cursors are displayed on web pages to give context. The above prefabs should do what you need, but take a look at the <code>CursorRenderer*</code> classes if you are doing something by hand or want to play around.</li>
<li>At present, the all clicks/touches/pointing is converted to a single mouse click and sent to the browser as such. Unfortunately, that means touch scrolling/gestures aren&#39;t presently available. (But you might be able to workaround this by using EvalJS.)</li>
<li>Mouse scroll speed and double-click handling options can be adjusted by altering myBrowserUI.InputSettings.</li>
</ul>
<h2 id="vr-input"><a class="header-link" href="#vr-input"></a>VR Input</h2>
<p>An input system is included for getting input from tracked VR controllers to point at and interact with a browser. Unity 2017.2 or newer is required.</p>
<p>Unity&#39;s VR controller input is a bit of a mess right now (see comment in VRInput.cs). To get input data form the controllers we use the direct APIs, which may require some extra setup.</p>
<p>First, do the usual setup to get VR running in your project (Player Settings » XR Settings). Then follow the instructions for the VR backend you are using below. Then look at the rest of this section.</p>
<h3 id="steamvr"><a class="header-link" href="#steamvr"></a>SteamVR</h3>
<p>Using the SteamVR runtime (and OpenVR API). This is for the HTC Vive, Oculus under SteamVR, and pretty much everything else.</p>
<p>First:</p>
<ul class="list">
<li>If you are using Unity 2018.3+: Install the OpenVR package (Window → Package Manager → OpenVR → Install)</li>
</ul>
<p>Then you have a couple options:</p>
<ul class="list">
<li><strong>Option A</strong>: Using &quot;hardcoded&quot; input, SteamVR 1.x style. Fast+simple. Incompatible with SteamVR package and reduced controller support.<ul class="list">
<li>Just...start using it. It should work right out of the box for a Vive wand or Oculus Touch.</li>
<li>By default, trigger is left click, grip is right click, and you can use the touchpads/joysticks to scroll. Click the touchpad or joystick to middle click. Extend <code>VRBrowserHand</code> to adjust/remap the inputs.</li>
</ul>
</li>
</ul>
<p>or</p>
<ul class="list">
<li><strong>Option B</strong>: Using SteamVR 2.0+ and its remappable input system. Requires the SteamVR package.<ul class="list">
<li>Open up <code>OpenVRConfig.cs</code> and change the mode to <code>InputMode.MappedActions</code>.</li>
<li>Grab the <a href="https://assetstore.unity.com/packages/tools/integration/steamvr-plugin-32647">SteamVR SDK</a> and import it.<ul class="list">
<li>SteamVR&#39;s Unity plugin has assorted bugs and issues so be prepared for some hitches.</li>
</ul>
</li>
<li>SteamVR should detect the action maps included with ZFBrowser and prompt you to import them.<ul class="list">
<li>If you already have any actions defined <strong>DON&#39;T IMPORT YET.</strong> Cancel the dialog repeatedly and close Unity.<ul class="list">
<li>SteamVR Unity version 2.3.2 doesn&#39;t correctly import default action mappings when merging.</li>
<li><a href="https://github.com/ValveSoftware/steamvr_unity_plugin/pull/494/files">Apply this patch</a>, then reopen Unity and import the ZFBrowser bindings.</li>
</ul>
</li>
<li>If you don&#39;t have any actions defined you can import the ZFBrowser actions immediately.</li>
</ul>
</li>
<li>More:<ul class="list">
<li>If pointing works but buttons don&#39;t then something isn&#39;t set up right. Things to check:<ul class="list">
<li>Is <code>OpenVRConfig.mode</code> set to <code>InputMode.MappedActions</code>?</li>
<li>The actions named in <code>OpenVRConfig.cs</code> must exist. <code>PointPose</code> and <code>LeftClickAction</code> are critical, the rest less so.</li>
<li>Is the action set active? (See below)</li>
<li>Are mapping defined for your controller? Assuming the default inputs: In Unity go to Window → SteamVR Input → Open binding UI → Under <code>Current Binding</code> click <code>Edit</code> for your controller → select the <code>ui</code> tab<ul class="list">
<li>Make sure <code>Mirror Mode</code> is on.</li>
<li>Make sure something, usually a trigger, is bound as <code>Interact With UI</code></li>
<li>Under <code>Edit Action Poses</code> make sure <code>UI Pointer</code> is bound to the controller&#39;s <code>Tip</code>.</li>
</ul>
</li>
</ul>
</li>
<li>You don&#39;t have to use the provided actions, you can set the browser to use whatever input names you want in <code>OpenVRConfig.cs</code>.<ul class="list">
<li>You can also change, disable, or remap the inputs in this file.</li>
</ul>
</li>
<li>If SteamVR doesn&#39;t prompt you try opening the SteamVR Input window and regenerating the bindings.</li>
<li>Default bindings are included for Vive wands and Oculus Touch.</li>
<li>If you have more than one action set you need to enable the Browser&#39;s actions set (<code>ui</code> by default) before browser inputs will work. You can use a <code>SteamVR_ActivateActionSetOnLoad</code> with the <code>Action Set</code> set to <code>\actions\ui</code> to enable it automatically.</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="oculus-vr"><a class="header-link" href="#oculus-vr"></a>Oculus VR</h3>
<ul class="list">
<li>If you are using Unity 2018.3+: Install the Oculus (Standalone) package (Window → Package Manager → Oculus (Standalone) → Install)</li>
<li>Grab the <a href="https://assetstore.unity.com/packages/tools/integration/oculus-integration-82022">Unity Oculus SDK</a> and import it.</li>
<li>In Unity go to Edit » Project Settings » Player » Other Settings » Scripting Define Symbols and add <code>OCULUS_API</code> to let ZFBrowser know to use it. (Or just uncomment <code>#define OCULUS_SDK</code> in VRInput.cs.)</li>
<li>Delete <code>ZFBrowser/Scripts/**.asmdef</code> (2 files).</li>
<li>This isn&#39;t specific to ZFBrowser, but you may want to call <code>XRDevice.SetTrackingSpaceType(TrackingSpaceType.RoomScale);</code> somewhere to make the Oculus API use the right coordinate system (y=0 at the floor). By default it will put y=0 at standing eye height which is...weird.</li>
</ul>
<h3 id="common"><a class="header-link" href="#common"></a>Common</h3>
<p>Once that&#39;s set up, you should be able to open up the <code>VR</code> demo scene and give it a try! (Use the <code>VR (SteamVR 2.0)</code> demo scene if you&#39;re using the SteamVR package with the new input system.)</p>
<p>To get things set up in your own scene:</p>
<ul class="list">
<li>Start by dropping a <code>Browser (VR)</code> prefab into the scene.</li>
<li>Find the <code>VRBrowserHand</code> prefab and drop a couple into your scene next to your camera. (For SteamVR this would be just inside the <code>[CameraRig]</code> prefab.) Use the inspector to assign one of them to the right hand. You can clear the <code>visualization</code>s if you don&#39;t want to use the default &quot;laser pointer&quot;.<ul class="list">
<li>Make sure the <code>VRBrowserHand</code>s have the same transform parent as the VR camera.</li>
<li>Make sure the VR camera starts with no rotation at its local origin, or things may not line up!</li>
</ul>
</li>
<li>Have at it!</li>
</ul>
<p>Also:</p>
<ul class="list">
<li>The default <code>Browser (VR)</code> prefab is set up to prevent accidental drags when clicking, which should make things a bit easier to interact with for those of us without surgeon hands. If you still find links hard to &quot;click&quot; on without holding your hand very still consider increasing the &quot;Drag Movement Threshold&quot; on the MeshPointerUI component.</li>
<li>Adding support for another VR backend might not be too much work. Take a look at <code>VRInput.cs</code> and <code>VRBrowserHand.cs</code> to get a feel for what may need to happen.<ul class="list">
<li>Buttons and poses are read in the descendant classes of <code>VRInput</code> in <code>VRInput.cs</code>.</li>
</ul>
</li>
</ul>
<h2 id="external-keyboard"><a class="header-link" href="#external-keyboard"></a>External Keyboard</h2>
<p>A world space keyboard is included for use with VR text entry and other times when a regular keyboard is not available. It can be linked to a browser and keystrokes entered on the virtual keyboard are passed to the browser.</p>
<p>Open the demo named <code>ExternalKeyboard</code> to try it out with your mouse!</p>
<p>This is mostly pure Qwerty layout without the top row. Modifiers have been swapped out for some shortcuts: select all text, undo/redo, and clipboard manipulation. There&#39;s some word-skipping buttons next to the arrows. You can also select characters/words by using shift followed by movement keys. There&#39;s also a few themes available. Click the ✩ where num lock would be to cycle through them.</p>
<p>You can customize the design of the keyboard, change the way a theme looks or which is the default, and even add or remove buttons. <code>ZFBrowser/Resources/Browser/Keyboard.html</code> contains the HTML for the keyboard. <code>ExternalKeyboard.cs</code> manages keyboard focus and typing/message routing.</p>
<p>To use it, drop the <code>ExternalKeyboard</code> prefab into your scene. By default it will link up to whichever browser seems to be focused, but you can toggle this behavior in the inspector. Also, take a look at the <code>VR</code> demo for an example.</p>
<h1 id="customization"><a class="header-link" href="#customization"></a>Customization</h1>
<ul class="list">
<li>Customize <code>alert()</code>, <code>prompt()</code>, <code>beforeUnload</code>, and password dialogs and the context menu by editing <code>ZFBrowser/Resources/Browser/Dialogs.html</code></li>
<li>Customize error pages by editing <code>ErrorGenerator.cs</code><ul class="list">
<li>Hook these events by listening to <code>Browser.onLoadError</code>/<code>onCertError</code>/<code>onSadTab</code>.</li>
</ul>
</li>
<li>Mouse cursors are:<ul class="list">
<li>Stored in <code>ZFBrowser/Resources/Browser/Cursors.png</code>. (These are more-or-less the base Chromium icons.)</li>
<li>Loaded and managed by the <code>BrowserCursor</code> class.</li>
<li>To change how a current cursor looks without altering the size, just edit Cursors.png.</li>
<li>If you wish to change the cursor sizes or which cursor types map to which Cursors.png item, take a look at IconGenerator.cs. (This script isn&#39;t intended for general use, so be prepared to get your hands dirty.)</li>
</ul>
</li>
</ul>
<h1 id="debugging"><a class="header-link" href="#debugging"></a>Debugging</h1>
<h2 id="page-debugging"><a class="header-link" href="#page-debugging"></a>Page Debugging</h2>
<p>Often during development, you will find your pages need debugging.</p>
<p>Tip: You don&#39;t always have to restart the game to test a change, in some cases you can simply refresh the page. (Unity inspector » browser instance » Refresh or Page inspector » ctrl+r).</p>
<p>Here&#39;s a few way to go about it:</p>
<h3 id="page-inspector"><a class="header-link" href="#page-inspector"></a>Page Inspector</h3>
<p>You can access the Webkit/Chromium inspector, which opens in a new window beside the running game.</p>
<ul class="list">
<li>Under the Editor in play mode: Select the Browser, then click &quot;Show Dev Tools&quot;</li>
<li>You can also use browser.ShowDevTools() to open an inspector window.</li>
</ul>
<h3 id="external-page-inspector"><a class="header-link" href="#external-page-inspector"></a>External Page Inspector</h3>
<p>You can access the page inspector from another browser or IDE that supports Chromium&#39;s debugger.</p>
<ul class="list">
<li>To debug when running in the Editor, visit <a href="http://localhost:9848/">http://localhost:9848/</a></li>
<li>To debug when running a debug build, visit <a href="http://localhost:9849/">http://localhost:9849/</a></li>
<li>Release builds cannot be debugged using this method.</li>
<li>Use a Chromium-based browser to load the above URLs. (If you have issues, try using the same Chromium version as the ZFBrowser does.)</li>
</ul>
<h3 id="ordinary-browser"><a class="header-link" href="#ordinary-browser"></a>Ordinary Browser</h3>
<p>You can also load your pages in an ordinary browser and debug them there. If you do, you may find it useful to create small &quot;log what happened&quot; stubs for the functions you expose from Unity. Call functions you want to test from the JavaScript console.</p>
<h1 id="cookies"><a class="header-link" href="#cookies"></a>Cookies</h1>
<p>By default cookies and profile data aren&#39;t saved between runs. Set <code>BrowserNative.ProfilePath</code> to a folder of your choice before the first Update to enable profile saving. (Or use a <code>BrowserSystemSettings</code> in your scene.)</p>
<ul class="list">
<li>Delete all cookies with <code>browser.CookieManager.ClearAll()</code>.</li>
<li>Grab the cookies from the browser with <code>browser.CookieManager.GetCookies()</code>. This is asynchronous and returns a promise, see <a href="#promises">the promise section</a> for more information on the promise library.</li>
<li>Once you have a cookie, you can make edits and call <code>cookie.Update()</code> or get rid of it with <code>cookie.Delete()</code>.</li>
<li>Create new cookies from scratch with <code>new Cookie(browsser.CookieManager)</code> adjust the fields (be sure to set at least a domain, name, and value!) then create it with <code>cookie.Update()</code>.</li>
<li>Aside from clearing all cookies, the Cookie API is a bit experimental, in particular, the dates may not function very well.</li>
</ul>
<h1 id="notes-2"><a class="header-link" href="#notes-2"></a>Notes</h1>
<ul class="list">
<li>You can customize which browser items the user is allowed to right-click (and get a context menu on). Look in the inspector under &quot;Allow Context Menu On&quot;. By default, only text boxes will allow a context menu.</li>
<li>Page background: By default, the <code>&lt;body&gt;</code> of pages will be rendered as transparent. You can change this to an opaque opaque color by setting the browser&#39;s Base Color to completely opaque. (If done from code, make sure to do this before the first Update() call.) Also, this <code>baseColor</code> value is used to clear the browser texture until we have a page render (usually a brief flash).<ul class="list">
<li>This can&#39;t be fully changed after a browser is initialized, but you can change the page itself by runnings scripts. For example: <code>browser.EvalJS(&quot;document.body.style.background = &#39;red&#39;&quot;)</code></li>
</ul>
</li>
<li>Custom mouse cursors are supported via <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/cursor">CSS cursors</a>.</li>
<li>You can control what happens when navigation attempts to open a new window.<ul class="list">
<li>Set the option you want in the inspector or call <code>browser.SetNewWindowHandler</code>.</li>
<li><code>Ignore</code> will just ignore the new window.</li>
<li><code>Redirect</code>, the default, will take the current window and send it to the new URL. (Note that some pop-up pages won&#39;t work if the parent is unloaded.)</li>
<li><code>NewBrowser</code> allows you create a new in-game browser to hold the new &quot;window&quot;. You need to write code and call <code>browser.SetNewWindowHandler</code> for this option. Take a look at the <code>NewWindow</code> demo!</li>
<li><code>NewWindow</code> opens the browser in a new OS window. Don&#39;t use this except for testing and debugging. The OS-level windows may have unstable, unexpected, or incomplete behavior</li>
</ul>
</li>
<li>We use a user agent that makes most websites think we&#39;re Chrome, but it does identify the engine, library, and your application&#39;s name and version. Change your application&#39;s name and version in the Player Settings.</li>
<li>You can force your own user agent by calling <code>UserAgent.SetUserAgent(string)</code>. This must be called before the first browser initializes.</li>
<li>Save user data between application runs by setting <code>BrowserNative.ProfilePath</code>. Also must be called before the first browser initializes.</li>
<li>You can use a <code>BrowserSystemSettings</code> in your scene to set the user agent or profile path without writing code.</li>
<li>It is normal to see several <code>ZFGameBrowser</code> child processes once a browser has been opened.</li>
<li>A number of events, such as page load error, are available for you to hook into. Search <code>Browser.cs</code> for &quot;public event&quot; and read the documentation above each.</li>
<li>Disabling the Browser MonoBehaviour will not stop the underlying browser from running. Destroy the object or load a blank page to free up resources a page is using.</li>
<li>It&#39;s not officially supported, but some features of WebRTC <em>might</em> work if you enable a certain command-line switch. See <code>BrowserNative.commandLineSwitches</code> and be sure to note the security implications.</li>
<li>Don&#39;t create folders named <code>GPUCache</code>, <code>VideoDecodeStats</code>, <code>blob_storage</code> where your project runs. Chromium may put things into such folders which are cleaned up on exit.</li>
<li>You can adjust the command-line switches sent to Chromium by fiddling with <code>BrowserNative.commandLineSwitches</code>. Read the comment above it in BrowserNative.cs for instructions.</li>
</ul>
<h2 id="latency/performance"><a class="header-link" href="#latency/performance"></a>Latency/Performance</h2>
<p>The browser is rendered offscreen in a separate process and the resulting pixels are transferred to a texture. Performance will not be as good as native Chromium, but should generally be fair to decent.</p>
<p>Latency:</p>
<ul class="list">
<li>All activity (mouse clicks, JS calls, input) is sent asynchronously to a separate renderer process and the results are asynchronously reported back. As such, there is a short delay between when a command is issued and when the results are visible. The delay should be quite reasonable in most cases, but don&#39;t expect results the same frame you issue a command.</li>
<li>Avoid using a Browser for latency-critical use cases such as rhythm games, world-aligned HUD markers, and rendering mouse cursors.</li>
</ul>
<p>Performance:</p>
<ul class="list">
<li>If framerates are more important for your use case, you may want to fiddle with the command-line option <code>--disable-gpu-vsync</code>. See <code>BrowserNative.commandLineSwitches</code>.</li>
<li>At present the texture is typically composited on the GPU, then pulled back to the CPU and uploaded again in Unity via <code>LoadRawTextureData</code>.<ul class="list">
<li>...unless you turn on mip-maps. Generating mipmaps is expensive, and we don&#39;t use <code>LoadRawTextureData</code>. The included prefabs turn off mipmap generation and use a special mipmap-emulating shader that &quot;fakes&quot; a texture with mipmaps, keeping ugly pixelation at bay for a minimal cost. (Check out the <code>Materials/EmulatedMipmap</code> folder.)</li>
</ul>
</li>
<li>You may have more success using lower-resolution images for animations and things that frequently update. Large sizes are more suitable for static displays and user interfaces.<ul class="list">
<li>At high enough resolutions, uploading to the GPU can become a notable bottleneck. There&#39;s typically a limit to the number of pixels/frame that can be updated without slowing down the game loop.</li>
</ul>
</li>
<li>Remember that on almost all systems the browsers use the same GPU for rendering that Unity does. If you have heavy content, be sure to factor this into your rendering budget.</li>
</ul>
<h2 id="architecture"><a class="header-link" href="#architecture"></a>Architecture</h2>
<p>Chromium doesn&#39;t play nice with others. To keep everyone happy and fix many bugs, Chromium is actually run in a separate process and we talk to it via IPC (a mixture of named pipes for messages and shared memory for the rendered buffer). You&#39;ll notice that your game spawns a ZFGameBrowser process which in turn spawns the usual Chromium child processes; this is normal.</p>
<h1 id="adobe-flash"><a class="header-link" href="#adobe-flash"></a>Adobe Flash</h1>
<p>This version of ZFBrowser includes some experimental support for Adobe Flash. Using this is discouraged and support for it may be removed in the future. Additional, note that Adobe <a href="https://www.adobe.com/products/flashplayer/faq.html">plans to end support</a> for Flash at the end of 2020.</p>
<p>Support for Flash is experimental. A command prompt window may flash while starting Flash content.</p>
<p>Enabling Flash requires some extra steps; see below.</p>
<h2 id="do-i-need-it?"><a class="header-link" href="#do-i-need-it?"></a>Do I need it?</h2>
<p>The Web is an evolving place and ever-increasingly interactive web sties don&#39;t need Flash to support media-rich content.</p>
<p>You need Flash if you want to:</p>
<ul class="list">
<li>Display content that is only available with Flash.</li>
<li>Watch video that uses proprietary codecs, such as h.264. ZFBrowser doesn&#39;t have licenses for these codecs, but Flash does and video streaming sites may fall back to using a Flash player to stream content if necessary.</li>
</ul>
<p>Note that outdated versions of the Flash plugin may not function. User interaction may be required to start Flash content.</p>
<h2 id="for-myself-(manual-install)"><a class="header-link" href="#for-myself-(manual-install)"></a>For myself (manual install)</h2>
<p>If you are developing locally, prototyping, or will only distribute your application to computers that you control, use this method.</p>
<p>Instructions:</p>
<ul class="list">
<li>Install the Adobe Flash Player on your system.<ul class="list">
<li>Go to <a href="https://get.adobe.com/flashplayer/otherversions/">https://get.adobe.com/flashplayer/otherversions/</a></li>
<li>Select your OS</li>
<li>Select the latest &quot;PPAPI&quot; version available.</li>
<li>Uncheck boxes for things you don&#39;t want.</li>
<li>Download now.</li>
</ul>
</li>
<li>Install using the usual methods for your OS.</li>
<li>Open up BrowserNative.cs. Under <code>commandLineSwitches</code> make sure <code>--enable-system-flash</code> is there.<ul class="list">
<li>For Linux: Try these arguments instead:<ul class="list">
<li><code>--ppapi-flash-path=/usr/lib/adobe-flashplugin/libpepflashplayer.so</code>, updating the path with the actual file location, if needed.</li>
<li><code>--ppapi-flash-version=29.0.0.113</code>, replacing the version with your actual version (look in <code>&lt;install folder&gt;/manifest.json</code>).</li>
</ul>
</li>
</ul>
</li>
<li>Go! (You may need to restart the Editor.)</li>
</ul>
<p>You&#39;ll need to install Flash on every computer you distribute your application to.</p>
<h2 id="for-anyone-(distribute-flash)"><a class="header-link" href="#for-anyone-(distribute-flash)"></a>For anyone (distribute Flash)</h2>
<p>To distribute Flash with your application, you&#39;ll need to get permission from Adobe and run their installer with your installer.</p>
<p>General flow: <small>Untested, let me know how it goes!</small></p>
<ul class="list">
<li>Start development using the instructions in the last section, including the <code>--enable-system-flash</code> flag. (You&#39;ll need to get creative for the Linux requirements.)</li>
<li>Get a distributor&#39;s license for your application<ul class="list">
<li><a href="http://www.adobe.com/products/players/flash-player-distribution.html">Apply here</a></li>
<li>Fill out paperwork, get approval from Adobe.</li>
<li>Get an installer from Adobe. You need the PPAPI version (for Chromium).</li>
</ul>
</li>
<li>Set up the Flash installer to run when your application installs.</li>
</ul>
<h1 id="get-help"><a class="header-link" href="#get-help"></a>Get Help</h1>
<p>Need help? You might find an answer to your question <a href="https://zenfulcrum.com/contact">here</a>. If not, send me an <a href="mailto:support@zenfulcrum.com">email</a>!</p>
</div>


</body></html>

